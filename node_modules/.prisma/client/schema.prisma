generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String    @id @default(uuid()) @db.Uuid
  email                   String    @unique
  username                String    @unique
  password                String
  plan                    String    @default("free") // 'free' | 'premium'
  avatar_url              String?
  telegram_chat_id        String?
  subscription_expires_at DateTime?
  created_at              DateTime  @default(now()) @map("created_at")
  updated_at              DateTime  @default(now()) @updatedAt @map("updated_at")
  signals                 Signal[]
  alerts                  Alert[]

  @@map("users")
}

model Signal {
  id           String    @id @default(uuid()) @db.Uuid
  symbol       String
  type         String // 'buy' | 'sell'
  entry_price  Decimal   @map("entry_price") @db.Decimal(18, 8)
  target_price Decimal   @map("target_price") @db.Decimal(18, 8)
  stop_loss    Decimal   @map("stop_loss") @db.Decimal(18, 8)
  confidence   Decimal   @db.Decimal(5, 2)
  status       String    @default("active") // 'active' | 'closed' | 'cancelled'
  user_id      String?   @map("user_id") @db.Uuid
  user         User?     @relation(fields: [user_id], references: [id])
  created_at   DateTime  @default(now()) @map("created_at")
  closed_at    DateTime? @map("closed_at")
  performance  Decimal?  @db.Decimal(10, 4)

  @@map("signals")
}

model Alert {
  id           String   @id @default(uuid()) @db.Uuid
  user_id      String   @map("user_id") @db.Uuid
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  symbol       String
  target_price Decimal  @map("target_price") @db.Decimal(18, 8)
  condition    String // 'above' | 'below'
  description  String?
  status       String   @default("active") // 'active' | 'triggered'
  created_at   DateTime @default(now()) @map("created_at")

  @@map("alerts")
}

model Asset {
  symbol        String   @id
  name          String
  current_price Decimal  @map("current_price") @db.Decimal(18, 8)
  change_24h    Decimal  @map("change_24h") @db.Decimal(10, 4)
  volume_24h    Decimal  @map("volume_24h") @db.Decimal(20, 8)
  market_cap    Decimal? @map("market_cap") @db.Decimal(20, 2)
  strength      String? // 'very_strong' | 'strong' | 'neutral' | 'weak' | 'very_weak'
  updated_at    DateTime @default(now()) @map("updated_at")

  @@map("assets")
}

model P2POpportunity {
  id                  String   @id @default(uuid()) @db.Uuid
  tipo                String
  exchange_entrada    String   @map("exchange_entrada")
  exchange_saida      String   @map("exchange_saida")
  preco_entrada       Decimal  @map("preco_entrada")
  preco_saida         Decimal  @map("preco_saida")
  diferenca_pct       Decimal  @map("diferenca_pct")
  comerciante_entrada String?  @map("comerciante_entrada")
  comerciante_saida   String?  @map("comerciante_saida")
  timestamp           DateTime @default(now())
  created_at          DateTime @default(now()) @map("created_at")

  @@map("p2p_opportunities")
}

model TradingOpportunity {
  id           String   @id @default(uuid()) @db.Uuid
  symbol       String
  score        Decimal?
  strength     String?
  signal       String?
  setup        String?
  volatility   Decimal?
  volume_ratio Decimal? @map("volume_ratio")
  rsi          Decimal?
  price        Decimal?
  detected_at  DateTime @map("detected_at")
  created_at   DateTime @default(now()) @map("created_at")

  @@map("trading_opportunities")
}

model ActiveTrade {
  id            String   @id @default(uuid()) @db.Uuid
  symbol        String
  side          String // 'LONG' | 'SHORT'
  setup         String
  score         Decimal  @db.Decimal(5, 2)
  strength      String?
  entry_price   Decimal  @map("entry_price") @db.Decimal(18, 8)
  current_price Decimal  @map("current_price") @db.Decimal(18, 8)
  pnl           Decimal  @db.Decimal(10, 4)
  duration      String?
  entry_time    DateTime @map("entry_time")
  updated_at    DateTime @default(now()) @map("updated_at")

  @@map("active_trades")
}

model TradeHistory {
  id          String   @id @default(uuid()) @db.Uuid
  symbol      String
  side        String // 'LONG' | 'SHORT'
  setup       String
  score       Decimal  @db.Decimal(5, 2)
  entry_price Decimal  @map("entry_price") @db.Decimal(18, 8)
  exit_price  Decimal  @map("exit_price") @db.Decimal(18, 8)
  pnl         Decimal  @db.Decimal(10, 4)
  result      String // 'WIN' | 'LOSS' | 'TAKE_PROFIT'
  duration    String?
  entry_time  DateTime @map("entry_time")
  exit_time   DateTime @map("exit_time")

  @@map("trade_history")
}

model SubscriptionKey {
  id            String    @id @default(uuid()) @db.Uuid
  key           String    @unique
  plan          String    @default("premium") // 'premium'
  duration_days Int       @default(30)
  status        String    @default("active") // 'active' | 'used'
  used_by       String?   @map("used_by") @db.Uuid
  used_at       DateTime? @map("used_at")
  created_at    DateTime  @default(now()) @map("created_at")

  @@map("subscription_keys")
}
